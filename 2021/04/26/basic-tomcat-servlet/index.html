

<!DOCTYPE html>
<html lang="ZH-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="luna">
  <meta name="keywords" content="博客,luna,java,spring,utils,linux,idea">
  <meta name="description" content="概念Servlet（Server Applet），全称Java Servlet，未有中文译文。是用Java编写的服务器端程序。其主要功能在于交互式地浏览和修改数据，生成动态Web内容。狭义的Servlet是指Java语言实现的一个接口，广义的Servlet是指任何实现了这个Servlet接口的类，一般情况下，人们将Servlet理解为后者。  Servlet运行于支持Java的应用服务器中。从实现">
<meta property="og:type" content="article">
<meta property="og:title" content="tomcat servlet">
<meta property="og:url" content="https://lunasaw.github.io/2021/04/26/basic-tomcat-servlet/index.html">
<meta property="og:site_name" content="十平方米小屋">
<meta property="og:description" content="概念Servlet（Server Applet），全称Java Servlet，未有中文译文。是用Java编写的服务器端程序。其主要功能在于交互式地浏览和修改数据，生成动态Web内容。狭义的Servlet是指Java语言实现的一个接口，广义的Servlet是指任何实现了这个Servlet接口的类，一般情况下，人们将Servlet理解为后者。  Servlet运行于支持Java的应用服务器中。从实现">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9705246-088f353b84544269.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp">
<meta property="og:image" content="https://tva1.sinaimg.cn/large/008i3skNly1gvo3i678zgg613v0me4qp02.gif">
<meta property="article:published_time" content="2021-04-26T10:55:54.000Z">
<meta property="article:modified_time" content="2022-09-16T02:41:51.982Z">
<meta property="article:author" content="luna">
<meta property="article:tag" content="tomcat">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://upload-images.jianshu.io/upload_images/9705246-088f353b84544269.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp">
  
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas><script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
  
  <title>tomcat servlet - 十平方米小屋</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/idea.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"lunasaw.github.io","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":65,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":"#"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":true,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"1WlABYJFX3ooWNnixAEsUHg2-gzGzoHsz","app_key":"4HAsQYXea2QPsxkF5wOFFpbH","server_url":"https://cn-n1-cell1.leancloud.cn","path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 40vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>十平方米小屋</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                链接
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/basic/tomcat-binner.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.2)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="tomcat servlet">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      luna
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-26 18:55" pubdate>
        2021年4月26日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.3k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      23 分钟
    </span>
  

  
  
    
      <!-- LeanCloud 统计文章PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">tomcat servlet</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：7 天前
                
              </p>
            
            <div class="markdown-body">
              <h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a><strong>概念</strong></h1><div class="hljs code-wrapper"><pre><code class="hljs java">Servlet（Server Applet），全称Java Servlet，未有中文译文。是用Java编写的服务器端程序。其主要功能在于交互式地浏览和修改数据，生成动态Web内容。狭义的Servlet是指Java语言实现的一个接口，广义的Servlet是指任何实现了这个Servlet接口的类，一般情况下，人们将Servlet理解为后者。

Servlet运行于支持Java的应用服务器中。从实现上讲，Servlet可以响应任何类型的请求，但绝大多数情况下Servlet只用来扩展基于HTTP协议的Web服务器。</code></pre></div>

<p><strong>Java Web</strong>，是基于Java语言实现web服务的技术总和。介于现在Java在web客户端应用的比较少，我把学习重点放在了JavaWeb服务端应用。虽然用Springboot就可以很快地搭建一个web项目了，但是如果想要深入了解JavaWeb的实现原理，就不得不先学习Servlet和Servlet容器的相关知识。</p>
<p>首先什么是Servlet？</p>
<p><strong>Servlet</strong>从广义上讲是Sun公司提供的一门用于开发动态Web资源的技术，而狭义上指的是实现了javax.servlet.Servlet接口的类的统称。Servlet接口很简单，只有init、getServletConfig、service、getServletInfo和destroy这5个方法，它们构成了实现Servlet功能的规范。像Spring的DispatcherServlet，都是一种具体的Servlet。</p>
<p>当然了，光有Servlet这一个类可没什么用，它没有main方法，不能独立运行，就像光有子弹没有枪，子弹的价值就发挥不出来。要想实现Servlet的功能，就必须有一个Servlet容器。</p>
<p><strong>Servlet容器</strong>，也叫做Servlet引擎，是web服务器的一部分，用于接收网络请求，把请求转发给对应的Servlet，并把Servlet处理的结果返回给网络。</p>
<p>它是web服务器和Servlet之间的媒介。</p>
<p>它建立服务端socket、监听端口、创建流。</p>
<p>它管理着Servlet的生命周期，如加载部署Servlet，实例化初始化Servlet，调用Servlet方法（处理业务），以及销毁Servlet。</p>
<p><strong>Tomcat</strong>就是一个独立运行的Servlet容器。</p>
<h1 id="Tomcat组织结构"><a href="#Tomcat组织结构" class="headerlink" title="Tomcat组织结构"></a>Tomcat组织结构</h1><p>下面就以Tomcat8为例，看看一个具体的Servlet容器是如何实现上述功能的。</p>
<p>先来一张Tomcat的结构图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9705246-088f353b84544269.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>Server：Tomcat顶层容器，代表着整个服务器。包含一个或多个Service组件；</p>
<p>Service：存活在Server内部的中间组件，包含Connector和Container这两个核心组件，负责将一个或多个Connector组件绑定到一个Container上；</p>
<p>Connector：监听端口，处理与客户端基于某种协议的通信，提供Socket与request和response的转换；</p>
<p>Container：封装和管理Servlet，负责对请求进行处理，并生成响应。</p>
<p>（先介绍这几个大的组件，小组件在后面会细讲）</p>
<p>这样展示可能比较抽象，我们可以打开我们安装的Tomcat目录下的conf/server.xml，看下Tomcat是如何配置这些组件的：</p>
<div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">Server</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8005&quot;</span> <span class="hljs-attr">shutdown</span>=<span class="hljs-string">&quot;SHUTDOWN&quot;</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-name">Service</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Catalina&quot;</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8080&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;HTTP/1.1&quot;</span> <span class="hljs-attr">connectionTimeout</span>=<span class="hljs-string">&quot;20000&quot;</span> <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> <span class="hljs-attr">URIEncoding</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>/&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">Connector</span> <span class="hljs-attr">port</span>=<span class="hljs-string">&quot;8009&quot;</span> <span class="hljs-attr">protocol</span>=<span class="hljs-string">&quot;AJP/1.3&quot;</span> <span class="hljs-attr">redirectPort</span>=<span class="hljs-string">&quot;8443&quot;</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Engine</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Catalina&quot;</span> <span class="hljs-attr">defaultHost</span>=<span class="hljs-string">&quot;localhost&quot;</span>&gt;</span> 
      <span class="hljs-tag">&lt;<span class="hljs-name">Host</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;localhost&quot;</span> <span class="hljs-attr">appBase</span>=<span class="hljs-string">&quot;webapps&quot;</span>&gt;</span> 
        ...
      <span class="hljs-tag">&lt;/<span class="hljs-name">Host</span>&gt;</span> 
   &lt;Host...
    <span class="hljs-tag">&lt;/<span class="hljs-name">Engine</span>&gt;</span> 

  <span class="hljs-tag">&lt;/<span class="hljs-name">Service</span>&gt;</span> 

<span class="hljs-tag">&lt;/<span class="hljs-name">Server</span>&gt;</span></code></pre></div>

<p>先看<strong>Connector</strong>，可以看到一个Service里是可以配置多个Connector的，这里我们主要关心HTTP协议的Connector。</p>
<p>Connector使用持有的ProtocolHandler类型对象来处理请求，它包含的三个部件：</p>
<p>Endpoint：绑定端口、监听请求；</p>
<p>Processor：将Endpoint接收到的Socket封装成Request；</p>
<p>Adapter：将Request交给Container进行具体的处理。</p>
<p>再看<strong>Container</strong>，它内部包含了4个子容器</p>
<p>Engine：Servlet引擎，Container最上层，每个Service只能包含一个，表示一个特定的Service的请求处理流水线，从Connector接收处理所有的请求并返回响应；</p>
<p>Host：虚拟主机，一个引擎可以包含多个Host；一个Host可以包含多个Context；</p>
<p>Context：一个Context表示了一个Web应用程序（Web工程）。Context直接管理Servlet在容器中的包装类；</p>
<p>Wrapper：每一个Servlet在容器中的包装类。</p>
<p>我们可以通过Tomcat文件夹里的文件结构来帮助理解，上面提到的conf/server.xml里配置Host时有个appBase的属性是webapps，是不是很眼熟？我们在Tomcat安装目录下总是有一个webapp文件夹，整个webapps就是一个Host站点，里面放着的每个文件夹目录就对应一个Context，其中ROOT目录中存放着主应用，其他目录存放着子应用。</p>
<h1 id="Tomcat类加载"><a href="#Tomcat类加载" class="headerlink" title="Tomcat类加载"></a>Tomcat类加载</h1><p>先看Tomcat是如何加载类的。</p>
<p>Tomcat启动时创建的类加载器有</p>
<blockquote>
<p>BootstrapClassLoader：加载JVM提供的基本运行类，和$JAVA_HOME/jre/lib/ext里的jar包；</p>
<p>SystemClassLoader：加载tomcat启动的类，即Catalina.bat中指定位置的类；</p>
<p>CommonClassLoader：加载tomcat以及应用通用的类，位于CATALINA_HOME/lib下。父加载器是AppClassLoader；</p>
<p>WebAppClassLoader：每个应用在部署后都创建一个唯一的类加载器，加载位于WEB-INF/lib中的jar包和WEB-INF/classes下的class文件。父加载器是CommonClassLoader。</p>
</blockquote>
<p>Tomcat默认类加载逻辑：</p>
<p>1、先在本地缓存中查找，如果已经加载即返回，否则继续下一步</p>
<p>2、尝试Bootstrap加载，如果加载到即返回，否则</p>
<p>3、WebApp自行加载，先/WEB-INF/classes，再/WEB-INF/lib/*.jar，如果加载到即返回，否则</p>
<p>4、委托WebApp父类加载器(Common ClassLoader)去加载。。。</p>
<p>注意：第3、4两步违反了双亲委托机制，但也只是Tomcat自定义的ClassLoader加载顺序违反了，顶层还是相同的。</p>
<p>Tomcat的这种加载逻辑保证了每个应用程序的同名类库是独立的，同时可以共享共有类库。</p>
<p>每一个JSP文件对应一个Jsp类加载器，当一个jsp文件修改了，就直接卸载这个jsp类加载器，重新创建类加载器，重新加载jsp文件。</p>
<h1 id="Tomcat启动流程"><a href="#Tomcat启动流程" class="headerlink" title="Tomcat启动流程"></a>Tomcat启动流程</h1><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gvo3i678zgg613v0me4qp02.gif" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>下面开始分析Tomcat大致启动流程，建议配合源码食用。</p>
<p>Tomcat传统的启动入口通过startup.bat和catalina.bat脚本调用org.apache.catalina.startup.Bootstrap.main()，分为两部分：</p>
<p>一、init()：初始化main线程的daemon（一个Bootstrap对象）。初始化Tomcat类加载器，通过反射来实例化Catalina对象；</p>
<p>二、daemon执行三个方法setAwait(true)、load(args)和start()：</p>
<p>1、setAwait：通过反射调用catalina的setAwait方法设置await属性，后面会用到；</p>
<p>2、load(args)：通过反射调用catalina的load方法，创建xml解析器，解析conf/server.xml创建出了StandardServer对象并init，继而调用内部包含的service的int，以此逐层初始化所有组件；</p>
<p>3、start()：通过反射调用catalina的start()方法，和init方法一样逐层start所有组件；最后利用前面设置的await属性调用await方法，继而调用server的await方法，保证主线程运行并持续监听8005端口的SHUTDOWN指令，接收到后调用stop方法关闭Tomcat。</p>
<p>上面各个组件的init和start都是一笔带过，那么他们实际完成了什么样的工作呢？</p>
<p>Server.init()：调用包含的Service的init；</p>
<p>Service.init()：初始化Engine，初始化Executor（所有Connector共享的线程池），初始化mapperListener（用来保存容器映射），调用Connector.init；</p>
<p>Connector.init()：初始化ProtocolHandler、Adapter，Endpoint创建ServerSocket并绑定监听端口</p>
<p>Server.start()：调用包含的Services的start;</p>
<p>Service.start()：与初始化对应，调用Engine.start，启动Executor，启动mapperListener（作为监听者加到容器和它们的子容器中），调用Connector.start</p>
<p>Connector.start()：Endpoint创建acceptor线程来接收客户端的连接以及poller线程来处理连接中的读写请求</p>
<p>Engine.start()：逐一启动Host、Context、Wrapper</p>
<p>Context.start()：步骤很多，这里列举几个重要的：</p>
<p>*）创建读取资源文件的对象</p>
<p>*）创建ClassLoader对象，就是上面提到过的每个应用唯一的WebAppClassLoader</p>
<p>*）设置应用的工作目录</p>
<p>*）启动相关辅助对象，如Logger、realm、resources等</p>
<p>*）通知监听者ContextConfig读取和解析Web应用web.xml和注解 </p>
<p>*）启动web.xml解析到的子容器（解析时将Servlet包装成StandardWrapper）</p>
<p>*）启动Pipeline（一种责任链设计模式后面会讲）</p>
<p>*）获取或创建ServletContext，并设置必要的参数</p>
<p>*）创建Context中配置的Listener；</p>
<p>*）创建和初始化配置的Filter；</p>
<p>*）创建和初始化loadOnStartup大于等于0的Servlet</p>
<h1 id="Tomcat处理请求过程"><a href="#Tomcat处理请求过程" class="headerlink" title="Tomcat处理请求过程"></a>Tomcat处理请求过程</h1><p>现在我们知道Tomcat是如何启动的，那么启动之后Tomcat如何处理一次请求的呢？</p>
<p>下面以一次Http请求为例来说明，请求URL=<a href="http://hostname:port/contextpath/servletpath。">http://hostname:port/contextpath/servletpath。</a></p>
<p>在Connector组件树中：</p>
<div class="note note-success">
            <p>前面启动的过程中提到过<code>Connector的Endpoint的acceptor线程负责接收Socket连接</code>，acceptor接收请求之后调用processSocket方法，把socket包装成SocketWrapper，创建一个SocketProcessor任务，从线程池中获取一个线程处理该任务。run方法中调用AbstractEndpoint.Handler.process方法，根据请求的协议类型（con/server.xml中connector元素的protocol属性值）创建相应的类型处理类Processor，对SocketWrapper的输入流和输出流进行包装，<strong>根据SocketWrapper创建轻量级的coyote.Request和coyote.Response</strong>，<code>解析http请求的请求头和请求行</code>，最后Adapter.service(Request, Response)，将coyote.Request和coyote.Response转化成Connector.Request和Connector.Response，调用connector.getService().getMapper().map()，根据hostname、contextpath和servletpath找到对应的host、context和Wapper（前面利用mapperListener保存的容器完整关系），设置到Request中去；再调用connector.getService().getContainer().getPipeline().getFirst().invoke(request, response)将请求传递给与Connector关联的Container逐级传递下去（Engine-&gt;Host-&gt;Context-&gt;Wapper）。</p>
          </div>

<p>在Container组件树中：</p>
<p><code>Container容器按照责任链的设计模式</code>，使用管道<code>Pipeline和Value</code>的方式来传递请求。</p>
<p>第一层是Engine，先通过conf/server.xml中配置的value，最后总会流到StandardEngineValue，调用host.getPipeline().getFirst().invoke(request, response)将请求传递给request中保存的Host；</p>
<p>第二层是Host，同样先通过配置的value，最后流到StandardHostValue，再传递给request中保存的Context；</p>
<p>第三层是Context，流到StandardContextValue传递给request中保存的Wapper；</p>
<p>最后是Wapper，流到StandardWapperValue，获取Servlet单例（双检查锁机制），获取FilterChain执行Filter链，也是一种责任链模式，执行完所有配置的Filter后执行Servlet.service，即我们希望其完成的业务逻辑。</p>
<p>（在进入Filter的时候，传入的是Connector.Request的门面类RequestFacade，和Request一样都是HttpServletRequest和HttpServletResponse的实现类）</p>
<p>返回过程略。</p>
<h2 id="专注HTTP请求的Servlet"><a href="#专注HTTP请求的Servlet" class="headerlink" title="专注HTTP请求的Servlet"></a>专注HTTP请求的Servlet</h2><p>1　写一个专门处理HTTP请求的Servlet</p>
<p>因为现在我们的请求都是基于HTTP协议的，所以我们应该专门为HTTP请求写一个Servlet做为通用父类。</p>
<p>对于专注于HTTP的Servlet，我们需要处理以下几个问题：</p>
<p>service()方法的参数ServletRequest和ServletResponse，但因为所有的请求都是HTTP请求，所以传递给service()就去的参数其实是HttpServletRequest和HttpServletResponse对象。如果子类希望使用的是HttpServletRequest，而不是ServletRequest，那么它需要自己去做强转。</p>
<p>Servlet：SUN公司 设计之初 以后不仅仅依赖HTTP协议</p>
<div class="hljs code-wrapper"><pre><code>   GenericServlet  --- 通用Servlet
   service(ServletRequest req, ServletResponse res)
   HttpServlet    --- 与协议相关的Servlet
   service(HttpServletRequest req, HttpServletResponse resp)
</code></pre></div>
<p> 以后再写Servlet  继承  HttpServlet</p>
<div class="hljs code-wrapper"><pre><code>   Servlet           --- 一个标准
          |
   GenericServlet      ---  是Servlet接口子类
          |
   HttpServlet    --- 是GenericServlet子类，一个专门处理Http请求的Servlet
</code></pre></div>
<p>HttpServlet</p>
<div class="hljs code-wrapper"><pre><code>   两个Service方法
          * 父类service 调用子类service   使用子类service方法就可以
          * 子类中service 根据请求方式不同 调用不同的方法
          只需要重写doGet和doPost就行.             

   写一个Servlet 继承HttpServlet

   重写doGet和doPost 方法.
</code></pre></div>
<p>没错，Java中已经存在了javax.servlet.http.HttpServlet类。打开源代码看看这个类！</p>
<p>2　HTTP请求方法<br>HTTP请求方法不只是GET和POST，还有其他的方法，但基本上用不上。这里只是简单介绍一下。你自己心里有个数，HTTP请求除了GET和POST之外还有别的就行了。</p>
<blockquote>
<p>GET通过请求URI得到资源<br>POST用于添加新的内容<br>PUT用于修改某个内容<br>DELETE,删除某个内容<br>CONNECT用于代理进行传输，如使用SSL<br>OPTIONS询问可以执行哪些方法<br>PATCH部分文档更改<br>RACE用于远程诊断服务器<br>HEAD类似于GET, 但是不返回body信息，用于检查对象是否存在，以及得到对象的元数据<br>TRACE用于远程诊断服务器</p>
</blockquote>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19782019/article/details/80292110">https://blog.csdn.net/qq_19782019/article/details/80292110</a>
<a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩</a></span></span></li></ol></div></section>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/basic-component/">basic-component</a>
                    
                      <a class="hover-with-bg" href="/categories/basic-component/tomcat/">tomcat</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/tomcat/">tomcat</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/05/09/linux-vim/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">linux vim</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/26/tomcat-interview/">
                        <span class="hidden-mobile">tomcat interview</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"Jf1XC66LVfvBgBpG1uzXEivd-gzGzoHsz","appKey":"UyOEEpxFaJC2kPqgBkDOeMPE","path":"window.location.pathname","placeholder":"说点什么","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"https://jf1xc66l.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":false,"appid":"Jf1XC66LVfvBgBpG1uzXEivd-gzGzoHsz","appkey":"UyOEEpxFaJC2kPqgBkDOeMPE"},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-x-md">
    <div class="container custom post-custom mx-auto">
      <img src="https://octodex.github.com/images/jetpacktocat.png" srcset="/img/loading.gif" lazyload class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;">
    </div>
  </div>


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
      <div class="col-lg-7 mx-auto nopadding-x-md">
        <div class="container custom mx-auto">
          </script><script src="/js/fireworks.js"></script><script src="https://api.vvhan.com/api/snow"></script>
        </div>
      </div>
    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <i class="iconfont icon-love"></i> <a href="https://github.com/czy1024" target="_blank" rel="nofollow noopener"><span>luna</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":true,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
